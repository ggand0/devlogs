# Slider Atlas Integration - Architecture Diagrams

**Date:** 2025-11-03

---

## Current Architecture (Dual Rendering Paths)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CURRENT: DUAL PATH ISSUE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SLIDER MODE (is_slider_moving = true)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  User moves slider                                                       â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  Message::SliderChanged(pane_idx, value)                                â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  create_async_image_widget_task()                                       â”‚
â”‚         â”‚                                                                â”‚
â”‚         â”œâ”€â–º Read image bytes                                            â”‚
â”‚         â”œâ”€â–º Handle::from_bytes(bytes)  â—„â”€â”€â”€ Creates iced Handle        â”‚
â”‚         â””â”€â–º Return (pane_idx, pos, Handle, dimensions)                  â”‚
â”‚                     â”‚                                                    â”‚
â”‚                     â–¼                                                    â”‚
â”‚  Message::SliderImageWidgetLoaded                                       â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  pane.slider_image = Some(Handle)                                       â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ UI Rendering (ui.rs:287)                                 â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  if is_slider_moving && slider_image.is_some() {        â”‚          â”‚
â”‚  â”‚      viewer::Viewer::new(slider_image)                   â”‚          â”‚
â”‚  â”‚  }                                                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ICED VIEWER WIDGET                                       â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  Handle â†’ raster::Cache.load()                           â”‚          â”‚
â”‚  â”‚      â”‚                                                    â”‚          â”‚
â”‚  â”‚      â”œâ”€â–º Decode: Memory::Host(ImageBuffer)              â”‚          â”‚
â”‚  â”‚      â”‚                                                    â”‚          â”‚
â”‚  â”‚      â””â”€â–º First render: raster::Cache.upload()           â”‚          â”‚
â”‚  â”‚              â”‚                                            â”‚          â”‚
â”‚  â”‚              â–¼                                            â”‚          â”‚
â”‚  â”‚          Atlas.upload(device, encoder, width, height)    â”‚          â”‚
â”‚  â”‚              â”‚                                            â”‚          â”‚
â”‚  â”‚              â”œâ”€â–º Allocate space in 2048x2048 atlas      â”‚          â”‚
â”‚  â”‚              â”œâ”€â–º Upload RGBA8/BC1 data                   â”‚          â”‚
â”‚  â”‚              â””â”€â–º Return atlas::Entry                     â”‚          â”‚
â”‚  â”‚                      â”‚                                    â”‚          â”‚
â”‚  â”‚                      â–¼                                    â”‚          â”‚
â”‚  â”‚          Memory::Device(atlas::Entry)                    â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ICED IMAGE RENDERER (iced_wgpu)                          â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  â€¢ Bind atlas texture                                    â”‚          â”‚
â”‚  â”‚  â€¢ Sample from atlas::Entry coordinates                  â”‚          â”‚
â”‚  â”‚  â€¢ Apply ContentFit::Contain transform                   â”‚          â”‚
â”‚  â”‚  â€¢ Render to screen                                      â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚     [Screen]                                                             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                               âš ï¸ VISUAL JUMP HERE âš ï¸
                         (Different rendering pipeline)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NORMAL MODE (is_slider_moving = false)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  User releases slider                                                    â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  Message::SliderReleased(pane_idx, value)                               â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  load_remaining_images()                                                 â”‚
â”‚         â”‚                                                                â”‚
â”‚         â”œâ”€â–º Load full-res image to cache                                â”‚
â”‚         â”œâ”€â–º Create GPU texture or CPU Scene                             â”‚
â”‚         â””â”€â–º pane.scene = Some(Scene::new(...))                          â”‚
â”‚                     â”‚                                                    â”‚
â”‚                     â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ UI Rendering (ui.rs:311)                                 â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  else if let Some(scene) = pane.scene.as_ref() {        â”‚          â”‚
â”‚  â”‚      ImageShader::new(Some(scene))                       â”‚          â”‚
â”‚  â”‚  }                                                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ IMAGESHADER WIDGET (custom)                              â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  Scene (TextureScene or CpuScene)                        â”‚          â”‚
â”‚  â”‚      â”‚                                                    â”‚          â”‚
â”‚  â”‚      â””â”€â–º Direct Arc<wgpu::Texture> reference            â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ IMAGEPRIMITIVE RENDERER                                  â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  prepare():                                               â”‚          â”‚
â”‚  â”‚    â€¢ Get texture from Scene                              â”‚          â”‚
â”‚  â”‚    â€¢ Calculate ContentFit bounds                         â”‚          â”‚
â”‚  â”‚    â€¢ Create TexturePipeline                              â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  render():                                                â”‚          â”‚
â”‚  â”‚    â€¢ Bind texture directly                               â”‚          â”‚
â”‚  â”‚    â€¢ Sample entire texture                               â”‚          â”‚
â”‚  â”‚    â€¢ Apply zoom/pan transforms                           â”‚          â”‚
â”‚  â”‚    â€¢ Render to screen                                    â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚     [Screen]                                                             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY DIFFERENCES:
â€¢ Slider: Atlas texture + atlas coordinates â†’ Iced shader
â€¢ Normal: Direct texture + full sampling â†’ Custom shader
â€¢ Result: Slight alignment/sampling differences = VISUAL JUMP
```

---

## Proposed Architecture (Unified Rendering)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROPOSED: UNIFIED ATLAS PATH                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SLIDER MODE (is_slider_moving = true)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  User moves slider                                                       â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  Message::SliderChanged(pane_idx, value)                                â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  create_async_slider_atlas_task()  â—„â”€â”€â”€ NEW                            â”‚
â”‚         â”‚                                                                â”‚
â”‚         â”œâ”€â–º Read image bytes                                            â”‚
â”‚         â”œâ”€â–º Extract dimensions (for layout)                             â”‚
â”‚         â””â”€â–º Return (pane_idx, pos, bytes, dimensions)  â—„â”€â”€â”€ No Handle  â”‚
â”‚                     â”‚                                                    â”‚
â”‚                     â–¼                                                    â”‚
â”‚  Message::SliderImageAtlasLoaded  â—„â”€â”€â”€ NEW                             â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  pane.slider_image_bytes = Some(bytes)  â—„â”€â”€â”€ NEW                       â”‚
â”‚  pane.slider_image_dimensions = Some(dims)                              â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ UI Rendering (pane.rs)                                   â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  if is_slider_moving && slider_image_bytes.is_some() {  â”‚          â”‚
â”‚  â”‚      SliderImageShader::new(                             â”‚          â”‚
â”‚  â”‚          pane_id,                                        â”‚          â”‚
â”‚  â”‚          image_idx,                                      â”‚          â”‚
â”‚  â”‚          bytes.clone()  â—„â”€â”€â”€ Pass bytes directly        â”‚          â”‚
â”‚  â”‚      )                                                    â”‚          â”‚
â”‚  â”‚  }                                                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SLIDERIMAGESHADER WIDGET (NEW)                           â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  â€¢ Holds pane_idx, image_idx, bytes                      â”‚          â”‚
â”‚  â”‚  â€¢ No iced Handle involved                               â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SLIDERIMAGEPRIMITIVE RENDERER (NEW)                      â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  prepare():                                               â”‚          â”‚
â”‚  â”‚    â€¢ Get/create SliderAtlasCache in storage              â”‚          â”‚
â”‚  â”‚    â€¢ Decode image from bytes                             â”‚          â”‚
â”‚  â”‚    â€¢ cache.get_or_upload(pane_idx, image_idx, bytes)    â”‚          â”‚
â”‚  â”‚          â”‚                                                â”‚          â”‚
â”‚  â”‚          â”œâ”€â–º Check cache: ImageKey{pane_idx, image_idx} â”‚          â”‚
â”‚  â”‚          â”‚                                                â”‚          â”‚
â”‚  â”‚          â”œâ”€â–º Cache HIT:                                  â”‚          â”‚
â”‚  â”‚          â”‚     â””â”€â–º Return cached atlas::Entry           â”‚          â”‚
â”‚  â”‚          â”‚                                                â”‚          â”‚
â”‚  â”‚          â””â”€â–º Cache MISS:                                 â”‚          â”‚
â”‚  â”‚                â””â”€â–º Atlas.upload(device, encoder, ...)   â”‚          â”‚
â”‚  â”‚                      â”‚                                    â”‚          â”‚
â”‚  â”‚                      â”œâ”€â–º Allocate in 2048x2048 atlas    â”‚          â”‚
â”‚  â”‚                      â”œâ”€â–º Upload RGBA8/BC1 data          â”‚          â”‚
â”‚  â”‚                      â”œâ”€â–º Evict oldest if cache full     â”‚          â”‚
â”‚  â”‚                      â””â”€â–º Return atlas::Entry            â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚    â€¢ Calculate ContentFit bounds                         â”‚          â”‚
â”‚  â”‚    â€¢ Store PreparedSliderImage in storage                â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  render():                                                â”‚          â”‚
â”‚  â”‚    â€¢ Get AtlasTexturePipeline                            â”‚          â”‚
â”‚  â”‚    â€¢ Bind atlas texture                                  â”‚          â”‚
â”‚  â”‚    â€¢ Sample from atlas::Entry coordinates                â”‚          â”‚
â”‚  â”‚    â€¢ Apply ContentFit transform (SAME MATH as Normal)   â”‚          â”‚
â”‚  â”‚    â€¢ Render to screen                                    â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚     [Screen]                                                             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                           âœ… NO JUMP - Unified Math âœ…

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NORMAL MODE (is_slider_moving = false)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  User releases slider                                                    â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  Message::SliderReleased(pane_idx, value)                               â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  load_remaining_images()  â—„â”€â”€â”€ UNCHANGED                                â”‚
â”‚         â”‚                                                                â”‚
â”‚         â”œâ”€â–º Load full-res image to cache                                â”‚
â”‚         â”œâ”€â–º Create GPU texture or CPU Scene                             â”‚
â”‚         â””â”€â–º pane.scene = Some(Scene::new(...))                          â”‚
â”‚                     â”‚                                                    â”‚
â”‚                     â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ UI Rendering (pane.rs)                                   â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  else if let Some(scene) = pane.scene.as_ref() {        â”‚          â”‚
â”‚  â”‚      ImageShader::new(Some(scene))  â—„â”€â”€â”€ UNCHANGED      â”‚          â”‚
â”‚  â”‚  }                                                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ IMAGESHADER WIDGET (UNCHANGED)                           â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  Scene (TextureScene or CpuScene)                        â”‚          â”‚
â”‚  â”‚      â”‚                                                    â”‚          â”‚
â”‚  â”‚      â””â”€â–º Direct Arc<wgpu::Texture> reference            â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ IMAGEPRIMITIVE RENDERER (MODIFIED for alignment)        â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  prepare():                                               â”‚          â”‚
â”‚  â”‚    â€¢ Get texture from Scene                              â”‚          â”‚
â”‚  â”‚    â€¢ Calculate ContentFit bounds â—„â”€â”€â”€ SAME MATH         â”‚          â”‚
â”‚  â”‚    â€¢ Create TexturePipeline                              â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â”‚  render():                                                â”‚          â”‚
â”‚  â”‚    â€¢ Bind texture directly                               â”‚          â”‚
â”‚  â”‚    â€¢ Use SHARED SHADER with slider path â—„â”€â”€â”€ KEY       â”‚          â”‚
â”‚  â”‚    â€¢ Apply zoom/pan transforms                           â”‚          â”‚
â”‚  â”‚    â€¢ Render to screen                                    â”‚          â”‚
â”‚  â”‚                                                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚     [Screen]                                                             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY IMPROVEMENTS:
â€¢ Both paths use same ContentFit calculation
â€¢ Both paths use shared shader code (unified_image_shader.wgsl)
â€¢ Slider uses atlas (fast), normal uses direct (full-res)
â€¢ Result: PIXEL-PERFECT ALIGNMENT, NO VISUAL JUMP
```

---

## SliderAtlasCache Internal Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SliderAtlasCache Structure                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SliderAtlasCache                                                   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Atlas (2048x2048 texture array)                         â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚  Layer 0: [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] (partially filled)       â”‚      â”‚
â”‚  â”‚  Layer 1: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] (partially filled)       â”‚      â”‚
â”‚  â”‚  Layer 2: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] (full)                   â”‚      â”‚
â”‚  â”‚  ...                                                     â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚  â€¢ Format: Rgba8UnormSrgb or Bc1RgbaUnormSrgb         â”‚      â”‚
â”‚  â”‚  â€¢ Size per layer:                                      â”‚      â”‚
â”‚  â”‚    - RGBA8: 16MB                                       â”‚      â”‚
â”‚  â”‚    - BC1: 2MB (8:1 compression)                        â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Entries: FxHashMap<ImageKey, CachedEntry>              â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚  ImageKey { pane_idx: 0, image_idx: 5 }               â”‚      â”‚
â”‚  â”‚    â†’ CachedEntry {                                      â”‚      â”‚
â”‚  â”‚        entry: Entry::Contiguous {                       â”‚      â”‚
â”‚  â”‚          layer: 0,                                      â”‚      â”‚
â”‚  â”‚          region: (x: 0, y: 0, width: 512, height: 512) â”‚      â”‚
â”‚  â”‚        },                                                â”‚      â”‚
â”‚  â”‚        dimensions: (512, 512),                          â”‚      â”‚
â”‚  â”‚        last_access: Instant::now(),                     â”‚      â”‚
â”‚  â”‚      }                                                   â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚  ImageKey { pane_idx: 0, image_idx: 6 }               â”‚      â”‚
â”‚  â”‚    â†’ CachedEntry { ... }                               â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚  ... (up to max_entries = 20)                          â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ LRU: VecDeque<ImageKey>                                â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚  [Oldest] â† [Key1, Key2, Key3, ..., KeyN] â† [Newest]  â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â”‚  â€¢ Eviction: pop_front() (oldest)                      â”‚      â”‚
â”‚  â”‚  â€¢ Access: move to back (most recent)                  â”‚      â”‚
â”‚  â”‚                                                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â”‚  max_entries: 20 (configurable)                                    â”‚
â”‚  device: Arc<wgpu::Device>                                         â”‚
â”‚  queue: Arc<wgpu::Queue>                                           â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FLOW: get_or_upload(pane_idx, image_idx, bytes)
  â”‚
  â”œâ”€â–º Check cache: entries.get(&ImageKey{pane_idx, image_idx})
  â”‚     â”‚
  â”‚     â”œâ”€â–º HIT: Update LRU, return cached entry
  â”‚     â”‚
  â”‚     â””â”€â–º MISS:
  â”‚           â”‚
  â”‚           â”œâ”€â–º Decode image from bytes
  â”‚           â”œâ”€â–º atlas.upload(device, encoder, width, height, data)
  â”‚           â”‚     â”‚
  â”‚           â”‚     â”œâ”€â–º Allocate space (guillotiere algorithm)
  â”‚           â”‚     â”œâ”€â–º Upload texture data to GPU
  â”‚           â”‚     â””â”€â–º Return atlas::Entry
  â”‚           â”‚
  â”‚           â”œâ”€â–º Check if cache full (entries.len() >= max_entries)
  â”‚           â”‚     â”‚
  â”‚           â”‚     â””â”€â–º YES: Evict oldest (lru.pop_front())
  â”‚           â”‚
  â”‚           â”œâ”€â–º Insert new entry into cache
  â”‚           â”œâ”€â–º Add key to LRU (lru.push_back())
  â”‚           â””â”€â–º Return new entry
  â”‚
  â””â”€â–º Result: AtlasImageInfo { entry, dimensions }
```

---

## COCO Annotation Alignment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              COCO Overlay Alignment (Current vs Proposed)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CURRENT (With Jump):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

While Sliding:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ Image  â”‚  â—„â”€â”€â”€ Viewer    â”‚
â”‚   â”‚        â”‚       widget     â”‚
â”‚   â”‚ [Bbox] â”‚  â—„â”€â”€â”€ COCO      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       shader     â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Release Slider:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚    â”‚ Image  â”‚  â—„â”€â”€â”€ Image-   â”‚
â”‚    â”‚        â”‚       Shader    â”‚
â”‚    â”‚[Bbox]  â”‚  â—„â”€â”€â”€ COCO     â”‚  âš ï¸ Image shifted 1-2px
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       shader     â”‚    Bbox stays in place
â”‚                                â”‚    = MISALIGNMENT
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PROPOSED (No Jump):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

While Sliding:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ Image  â”‚  â—„â”€â”€â”€ Slider-   â”‚
â”‚   â”‚        â”‚       ImageShaderâ”‚
â”‚   â”‚ [Bbox] â”‚  â—„â”€â”€â”€ COCO      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       shader     â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Release Slider:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ Image  â”‚  â—„â”€â”€â”€ Image-    â”‚
â”‚   â”‚        â”‚       Shader     â”‚
â”‚   â”‚ [Bbox] â”‚  â—„â”€â”€â”€ COCO      â”‚  âœ… Same shader math
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       shader     â”‚     = PERFECT ALIGNMENT
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY: Both modes use identical ContentFit calculation
     â†’ Image stays in exact same position
     â†’ Bboxes remain perfectly aligned
```

---

## Data Flow Timeline

```
User Action: Move slider from position 0 â†’ 5 â†’ 10 â†’ 15 (then release)

Timeline:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

t=0ms: SliderChanged(value=5)
  â”‚
  â”œâ”€â–º create_async_slider_atlas_task(image_idx=5)
  â”‚     â”‚
  â”‚     â””â”€â–º Load bytes (blocking file I/O)
  â”‚
  â”œâ”€â–º SliderChanged(value=10)  â—„â”€â”€â”€ User moved slider again
  â”‚     â”‚
  â”‚     â””â”€â–º create_async_slider_atlas_task(image_idx=10)
  â”‚           â”‚
  â”‚           â””â”€â–º Load bytes
  â”‚
  â””â”€â–º (Previous task for image_idx=5 completes)

t=3ms: SliderImageAtlasLoaded(pane_idx=0, pos=5, bytes, dims)
  â”‚
  â”œâ”€â–º pane.slider_image_bytes = bytes
  â”œâ”€â–º pane.slider_image_dimensions = dims
  â”‚
  â””â”€â–º UI re-renders with SliderImageShader
        â”‚
        â””â”€â–º prepare():
              â”‚
              â”œâ”€â–º cache.get_or_upload(0, 5, bytes)
              â”‚     â”‚
              â”‚     â”œâ”€â–º Cache MISS (first time)
              â”‚     â”œâ”€â–º Decode image
              â”‚     â”œâ”€â–º Atlas.upload()  â—„â”€â”€â”€ ~2ms GPU upload
              â”‚     â””â”€â–º Return atlas::Entry
              â”‚
              â””â”€â–º render():
                    â”‚
                    â””â”€â–º Draw from atlas  â—„â”€â”€â”€ <0.1ms

t=8ms: SliderImageAtlasLoaded(pane_idx=0, pos=10, bytes, dims)
  â”‚
  â”œâ”€â–º pane.slider_image_bytes = bytes
  â”‚
  â””â”€â–º UI re-renders
        â”‚
        â””â”€â–º prepare():
              â”‚
              â””â”€â–º cache.get_or_upload(0, 10, bytes)
                    â”‚
                    â”œâ”€â–º Cache MISS
                    â”œâ”€â–º Atlas.upload()
                    â””â”€â–º Return entry

t=15ms: SliderChanged(value=15)
  â”‚
  â””â”€â–º Same flow...

t=100ms: SliderReleased(value=15)
  â”‚
  â”œâ”€â–º is_slider_moving = false
  â”‚
  â”œâ”€â–º load_remaining_images()
  â”‚     â”‚
  â”‚     â”œâ”€â–º Load full-res image
  â”‚     â””â”€â–º pane.scene = Some(Scene::new(...))
  â”‚
  â””â”€â–º UI re-renders with ImageShader
        â”‚
        â””â”€â–º Uses pane.scene (full-res texture)
              â”‚
              â””â”€â–º Same ContentFit math as slider
                    â”‚
                    â””â”€â–º âœ… NO VISUAL JUMP

Performance Notes:
- Image decode: ~1-2ms (depends on size)
- Atlas upload: ~2-5ms (first time)
- Cache hit: <0.1ms (subsequent renders)
- Total latency: ~5-10ms per image (acceptable for slider)
```

---

## Memory Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          GPU Memory Layout                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Atlas Textures (SliderAtlasCache):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 0: 2048x2048 BC1                    ~2MB              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚ â”‚Img 0   â”‚Img 1   â”‚Img 2   â”‚      â”‚                       â”‚
â”‚ â”‚512x512 â”‚800x600 â”‚1024x768â”‚ Free â”‚                       â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚ â”‚Img 3   â”‚                                                 â”‚
â”‚ â”‚512x512 â”‚           Free Space                           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: 2048x2048 BC1                    ~2MB              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚ â”‚Img 4   â”‚Img 5   â”‚              â”‚                        â”‚
â”‚ â”‚640x480 â”‚1920x1080 (fragmented) â”‚                        â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚ â”‚Img 6   â”‚                                                 â”‚
â”‚ â”‚512x512 â”‚           Free Space                           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Atlas Memory: 2 layers Ã— 2MB = 4MB (example)
Max with 20 images: ~10-20MB (depends on image sizes)


Direct Textures (Scene):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pane 0: Current Image (full-res)                           â”‚
â”‚   â€¢ 2048x2048 RGBA8 = 16MB                                 â”‚
â”‚   â€¢ OR 2048x2048 BC1 = 2MB                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pane 1: Current Image (if dual-pane)                       â”‚
â”‚   â€¢ 2048x2048 RGBA8 = 16MB                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Total GPU Memory (Example):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Atlas:          10-20MB  (slider cache)
Direct Textures: 2-32MB  (current images, depends on panes)
COCO Shaders:    1-2MB   (bbox/mask vertex buffers)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:          ~15-55MB (acceptable for modern GPUs)
```

---

## Summary

âœ… **Unified rendering** eliminates visual jump  
âœ… **Atlas caching** maintains slider performance  
âœ… **Shared shader math** ensures pixel-perfect alignment  
âœ… **Memory efficient** with BC1 compression  
âœ… **LRU eviction** prevents unbounded growth  
âœ… **COCO annotations** stay perfectly aligned  

**Next Steps**: Begin Phase 1 implementation! ğŸš€


